{% extends "layout.html" %}

{% block app_content %}
    <h1>{{ header }}</h1>
    <p><a href="{{ url_for('add_sicklist') }}">Добавить больничный лист</a></p>
    <table class="table table-condensed">
        <thead>
            <tr>
                <th></th>
                <th>№ б/л</th>
                <th>б/л открыт</th>
                <th>Пациент (ФИО)</th>
                <th>Доктор</th>
                <th>Диагноз</th>
                <th>1-й СО</th>
                <th>2-й СО</th>
                <th>ВКК</th>
                <th>Статус б/л</th>
                
                <th>б/л закрыт</th>
            </tr>
        </thead>
        <tbody>
            {% for list in sicklists %}
            <tr>
                <td>
                    <a href="{{ url_for('edit_list', id=list.id) }}">
                        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                    </a>
                </td>
                <td>{{ list.sick_list_number }}</td>
                <td>{{ moment(list.start_date).format('L') }}</td>
                <td>
                    <a href="{{ url_for('patient', id = list.patient.id) }}">
                    {{ list.patient.last_name + " " + list.patient.first_name + " " + list.patient.middle_name }}
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('employe', id = list.doctor.id) }}">
                    {{ list.doctor.last_name + " " + list.doctor.first_name + " " + list.doctor.middle_name }}
                    </a>
                </td>
                <td>{{ list.diacrisis }}</td>

                <td {% if today == list.first_checkin %} class="success" {% endif %}>
                {{ moment(list.first_checkin).format('L') }}</td>

                <td {% if today == list.second_checkin %} class="success" {% endif %}>
                {{ moment(list.second_checkin).format('L') }}</td>

                <td {% if today == list.vkk %} class="success" {% endif %}>
                {{ moment(list.vkk).format('L') }}</td>

                <td>
                    {% if list.status == 'open' %}
                    открыт
                    {% elif list.status == 'end' %}
                    закрыт
                    {% elif list.status == 'relocated' %}
                    переведен
                    {% endif %}
                </td>
                
                <td>
                    {% if list.end_date %}
                    {{ list.end_date }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}